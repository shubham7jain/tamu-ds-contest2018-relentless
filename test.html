<!DOCTYPE html>
<html>
  <head>
    <title>Data Layer: Simple</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>

       function loadJSON(callback) {   

        var xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
        xobj.open('GET', 'test.json', true); // Replace 'my_data' with the path to your file
        xobj.onreadystatechange = function () {
              if (xobj.readyState == 4 && xobj.status == "200") {
                // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                callback(xobj.responseText);
              }
        };
        xobj.send(null);  
     }

      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8,
          center: {lat: 41.87, lng: -87.62},
          styles: [
            // {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
          //   {elementType: 'geometry', stylers: [{color: '#1a1a1a'}]},
          //   {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
          //   {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
          //   {
          //     featureType: 'administrative.locality',
          //     elementType: 'labels.text.fill',
          //     stylers: [{color: '#f2f2f2'}]
          //   },
          //   {
          //     featureType: 'poi',
          //     elementType: 'labels.text.fill',
          //     stylers: [{color: '#d59563'}]
          //   },
          //   {
          //     featureType: 'poi.park',
          //     elementType: 'geometry',
          //     stylers: [{color: '#808080'}]
          //   },
          //   {
          //     featureType: 'poi.park',
          //     elementType: 'labels.text.fill',
          //     stylers: [{color: '#6b9a76'}]
          //   },
          //   {
          //     featureType: 'road',
          //     elementType: 'geometry',
          //     stylers: [{color: '#ffc299'}]
          //   },
          //   {
          //     featureType: 'road',
          //     elementType: 'geometry.stroke',
          //     stylers: [{color: '#212a37'}]
          //   },
          //   {
          //     featureType: 'road',
          //     elementType: 'labels.text.fill',
          //     stylers: [{color: '#9ca5b3'}]
          //   },
          //   {
          //     featureType: 'road.highway',
          //     elementType: 'geometry',
          //     stylers: [{color: '#746855'}]
          //   },
          //   {
          //     featureType: 'road.highway',
          //     elementType: 'geometry.stroke',
          //     stylers: [{color: '#1f2835'}]
          //   },
          //   {
          //     featureType: 'road.highway',
          //     elementType: 'labels.text.fill',
          //     stylers: [{color: '#f3d19c'}]
          //   },
          //   {
          //     featureType: 'transit',
          //     elementType: 'geometry',
          //     stylers: [{color: '#2f3948'}]
          //   },
          //   {
          //     featureType: 'transit.station',
          //     elementType: 'labels.text.fill',
          //     stylers: [{color: '#d59563'}]
          //   },
          //   {
          //     featureType: 'water',
          //     elementType: 'geometry',
          //     stylers: [{color: '#404040'}]
          //   },
          //   {
          //     featureType: 'water',
          //     elementType: 'labels.text.fill',
          //     stylers: [{color: '#515c6d'}]
          //   },
          //   {
          //     featureType: 'water',
          //     elementType: 'labels.text.stroke',
          //     stylers: [{color: '#17263c'}]
          //   }
          // ]
          // [
            {
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#212121"
                }
              ]
            },
            {
              "elementType": "labels.icon",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#757575"
                }
              ]
            },
            {
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#212121"
                }
              ]
            },
            {
              "featureType": "administrative",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#757575"
                }
              ]
            },
            {
              "featureType": "administrative.country",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#9e9e9e"
                }
              ]
            },
            {
              "featureType": "administrative.land_parcel",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "administrative.land_parcel",
              "elementType": "labels",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "administrative.locality",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#bdbdbd"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#757575"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#181818"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#616161"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#1b1b1b"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "geometry.fill",
              "stylers": [
                {
                  "color": "#2c2c2c"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#8a8a8a"
                }
              ]
            },
            {
              "featureType": "road.arterial",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#373737"
                }
              ]
            },
            {
              "featureType": "road.arterial",
              "elementType": "labels",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#3c3c3c"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "labels",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road.highway.controlled_access",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#4e4e4e"
                }
              ]
            },
            {
              "featureType": "road.local",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road.local",
              "elementType": "labels",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road.local",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#616161"
                }
              ]
            },
            {
              "featureType": "transit",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#757575"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#000000"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#3d3d3d"
                }
              ]
            }
          ]
        });

        loadJSON(function(response) {
        // Parse JSON string into object
          var actual_JSON = JSON.parse(response);
          map.data.addGeoJson(actual_JSON);

          var communityCodeMap = {};
          // var orderOfCommunities2016 = ['54','74','52','55','47','72','53','75','50','9','18','65','73','51','48','63','45','26','70','37','67','66','57','46','62','71','68','64','40','17','36','61','58','69','20','27','29','30','12','44','42','49','19','43','60','38','25','23','10','13','31','15','59','39','34','35','11','14','21','41','16','1','2','4','5','22','77','3','56','33','24','7','6','76','28','32','8'];
          // var countMap = {'1':62105,'2':63414,'3':243517,'4':66439,'5':76582,'6':951808,'7':733344,'8':5908779,'9':500,'10':9346,'11':27039,'12':3481,'13':9695,'14':35171,'15':13843,'16':58875,'17':2329,'18':616,'19':5279,'20':2774,'21':38285,'22':138445,'23':7782,'24':457413,'25':6430,'26':901,'27':2907,'28':1580844,'29':3050,'30':3194,'31':12525,'32':4288839,'33':398074,'34':18200,'35':19720,'36':2461,'37':927,'38':6211,'39':16088,'40':1947,'41':55465,'42':4560,'43':5298,'44':3828,'45':832,'46':1206,'47':214,'48':819,'49':4993,'50':474,'51':793,'52':121,'53':393,'54':58,'55':148,'56':320153,'57':1049,'58':2616,'59':14896,'60':5740,'61':2562,'62':1392,'63':823,'64':1917,'65':724,'66':987,'67':971,'68':1682,'69':2639,'70':918,'71':1394,'72':381,'73':724,'74':84,'75':407,'76':1230262,'77':169907}
          var tripCountMap2016 = {'1':11.036582,'2':11.057440,'3':12.402942,'4':11.104040,'5':11.246117,'6':13.766119,'7':13.505370,'8':15.591950,'9':6.214608,'10':9.142704,'11':10.205036,'12':8.155075,'13':9.179366,'14':10.467977,'15':9.535535,'16':10.983172,'17':7.753194,'18':6.423247,'19':8.571492,'20':7.928046,'21':10.552813,'22':11.838228,'23':8.959569,'24':13.033342,'25':8.768730,'26':6.803505,'27':7.974877,'28':14.273469,'29':8.022897,'30':8.069029,'31':9.435482,'32':15.271527,'33':12.894393,'34':9.809177,'35':9.889389,'36':7.808323,'37':6.831954,'38':8.734077,'39':9.685829,'40':7.574045,'41':10.923507,'42':8.425078,'43':8.575085,'44':8.250098,'45':6.723832,'46':7.095064,'47':5.365976,'48':6.708084,'49':8.515792,'50':6.161207,'51':6.675823,'52':4.795791,'53':5.973810,'54':4.060443,'55':4.997212,'56':12.676554,'57':6.955593,'58':7.869402,'59':9.608848,'60':8.655214,'61':7.848543,'62':7.238497,'63':6.712956,'64':7.558517,'65':6.584791,'66':6.894670,'67':6.878326,'68':7.427739,'69':7.878155,'70':6.822197,'71':7.239933,'72':5.942799,'73':6.584791,'74':4.430817,'75':6.008813,'76':14.022738,'77':12.043007}

          var meanCostMap2016 = {'59':8.424615,'28':11.994465,'8':12.494481,'24':12.578610,'32':12.814900,'7':12.854611,'21':13.005009,'49':13.257180,'35':13.500335,'22':13.525495,'2':13.693096,'23':13.960011,'11':13.982970,'13':14.067408,'4':14.175164,'6':14.204137,'20':14.296564,'38':14.350525,'3':14.468132,'16':14.574302,'1':14.625711,'77':14.814380,'58':14.844553,'5':14.917992,'40':15.196718,'14':15.455648,'47':15.478926,'15':15.718910,'31':15.813082,'64':15.985044,'36':16.001423,'19':16.241917,'27':16.388659,'61':16.429293,'33':16.504234,'34':16.508440,'60':16.675200,'25':17.562981,'63':17.710510,'50':17.786476,'70':18.011547,'18':18.363880,'68':18.893953,'44':18.951389,'12':19.021744,'26':19.137281,'9':19.238140,'29':19.332809,'69':19.434998,'39':19.617619,'45':19.860529,'10':20.532713,'37':20.730453,'67':20.730906,'43':20.774288,'57':20.888933,'51':20.921513,'66':20.985857,'17':21.198828,'42':21.313837,'65':22.344503,'48':22.986155,'30':22.999859,'46':23.021601,'41':23.927685,'71':25.851557,'53':25.854174,'72':29.264803,'73':31.179834,'75':31.503759,'74':32.350239,'62':32.990116,'54':33.966034,'52':34.278759,'55':36.096283,'56':43.247406,'76':49.003998}

          var meanTimeMap2016 = {'59':281.307532,'58':598.497706,'24':663.925411,'8':664.495459,'28':673.655419,'21':676.456027,'32':683.491642,'7':707.660410,'49':709.037853,'22':721.700004,'11':737.072599,'2':738.279828,'13':757.722744,'38':762.050877,'40':771.120699,'3':771.652373,'77':774.381338,'6':776.407042,'35':776.781846,'1':786.296578,'64':795.996870,'16':800.511847,'23':801.020560,'4':802.265221,'36':802.440065,'47':829.906542,'14':834.119616,'37':840.620280,'34':842.231044,'9':843.690000,'50':846.732068,'74':851.428571,'51':863.838588,'5':865.690280,'31':881.913054,'20':884.985580,'27':887.840729,'15':902.666041,'60':905.236411,'10':907.311791,'12':916.745763,'61':917.992584,'57':928.849380,'33':944.348825,'70':953.555556,'39':960.496954,'19':980.781398,'63':986.325638,'44':993.476489,'69':1004.012126,'45':1023.500000,'48':1032.030525,'68':1038.458383,'43':1057.645338,'17':1059.544440,'25':1065.977916,'26':1080.504994,'46':1084.337479,'30':1086.208203,'29':1098.764262,'53':1103.206107,'18':1104.837662,'42':1131.052632,'41':1153.156243,'71':1169.311334,'72':1171.425197,'67':1184.594233,'65':1257.053867,'66':1258.017224,'73':1310.266575,'54':1321.034483,'75':1344.459459,'52':1529.256198,'62':1552.217672,'55':1596.195946,'56':1740.565177,'76':1939.533516}

          var tripCountMap2013 = {'55':4.644391,'54':4.736198,'74':4.859812,'52':5.209486,'47':5.472271,'50':5.783825,'72':6.291569,'75':6.318968,'53':6.326149,'51':6.609349,'9':6.680855,'45':6.828712,'73':6.837333,'70':6.963190,'65':7.003065,'63':7.015712,'64':7.026427,'62':7.100027,'37':7.120444,'67':7.134891,'71':7.220374,'66':7.249926,'49':7.329750,'57':7.387090,'46':7.523481,'18':7.545390,'48':7.621685,'40':7.642524,'26':7.647786,'68':7.649693,'29':7.877776,'36':7.906179,'61':7.944847,'20':8.020928,'69':8.115521,'58':8.131825,'17':8.196712,'30':8.248529,'27':8.281977,'44':8.361942,'12':8.668196,'38':8.747670,'19':8.819961,'43':9.062304,'42':9.096724,'23':9.188299,'10':9.224243,'60':9.249561,'13':9.556621,'25':9.672879,'15':9.851931,'59':9.994698,'31':10.103935,'39':10.184334,'34':10.196381,'11':10.238423,'35':10.362209,'14':10.899809,'21':11.245556,'2':11.326897,'41':11.358410,'1':11.412177,'16':11.533532,'4':11.752965,'5':12.166042,'77':12.494412,'56':12.610487,'22':12.748179,'3':12.975750,'33':13.103951,'24':13.847529,'76':13.896332,'7':14.273361,'28':14.432017,'6':14.473981,'32':15.320712,'8':15.796731}

          var meancostMap2013 = {'59':8.787446,'25':10.360518,'28':11.373662,'24':11.589289,'32':11.768712,'8':11.771774,'7':11.785314,'21':12.265811,'22':12.285173,'27':12.306508,'26':12.319861,'35':12.770445,'16':12.805145,'6':12.967941,'5':13.040669,'18':13.132225,'23':13.249215,'4':13.313225,'31':13.369586,'3':13.453227,'15':13.537632,'36':13.538497,'11':13.718965,'13':13.856612,'33':13.970575,'48':14.078041,'2':14.143438,'69':14.317122,'34':14.407741,'60':14.527013,'14':14.619958,'17':14.634954,'77':14.704314,'37':14.836912,'40':14.878969,'63':14.881598,'44':14.943074,'61':15.052201,'58':15.253035,'68':15.574257,'1':15.699857,'38':15.730300,'19':15.855603,'67':16.152334,'66':16.352947,'47':16.771555,'65':16.920046,'12':16.945423,'73':17.136738,'45':17.169914,'9':17.340137,'43':17.737949,'64':18.238783,'39':18.243656,'49':18.340551,'10':18.382669,'30':18.730991,'20':18.870588,'50':19.266062,'51':19.779016,'70':19.786415,'71':20.306547,'75':21.192108,'42':21.520987,'62':21.550644,'29':21.553465,'41':21.902393,'72':23.129185,'57':25.031809,'53':25.072630,'55':25.604424,'74':25.918062,'46':26.120871,'54':28.018772,'56':34.194378,'52':37.577049,'76':39.418171}

          var meanTimeMap2013 = {'59':248.368781,'58':523.716554,'25':584.279327,'8':625.528563,'32':630.800680,'28':638.426707,'27':650.845142,'24':650.856095,'7':654.203203,'21':687.436209,'22':703.121843,'6':710.659854,'2':718.496838,'26':723.721374,'3':727.337326,'13':735.859386,'16':745.959719,'5':763.886194,'11':764.120614,'34':779.460569,'77':784.598676,'36':786.366986,'48':793.868756,'4':795.946983,'35':797.914099,'31':800.681697,'15':808.027376,'33':825.093445,'37':830.008084,'23':830.210591,'40':841.467626,'1':841.631791,'14':843.528043,'12':847.088564,'17':853.987324,'38':863.395807,'10':872.893491,'68':878.428571,'69':887.824268,'9':891.342535,'60':891.369231,'65':908.290909,'64':921.314387,'73':937.532189,'44':937.939734,'63':940.179533,'29':948.081880,'57':949.634675,'18':952.991543,'20':963.626807,'39':965.727015,'19':974.060284,'61':974.484225,'43':976.704545,'70':986.281930,'51':1039.487871,'66':1057.031250,'72':1063.888889,'50':1068.738462,'30':1080.675039,'67':1084.446215,'75':1089.837838,'71':1098.083394,'49':1100.577049,'74':1114.418605,'62':1139.603960,'45':1140.454545,'41':1160.364833,'42':1163.795653,'55':1172.884615,'46':1181.458671,'47':1310.420168,'52':1420.327869,'54':1504.736842,'53':1534.132379,'56':1632.481706,'76':1855.325689}

          var tripCountMap2014 = {'54':4.890349,'55':4.969813,'74':4.997212,'47':5.141664,'52':5.313206,'50':5.710427,'53':6.269096,'75':6.357842,'72':6.475433,'73':6.770789,'51':6.810142,'9':6.812345,'45':7.106606,'63':7.161622,'48':7.180831,'37':7.189168,'26':7.229839,'67':7.280697,'70':7.362011,'65':7.369601,'66':7.383989,'18':7.415777,'49':7.440147,'46':7.455877,'71':7.506592,'62':7.507141,'64':7.587311,'57':7.727535,'68':7.845416,'40':7.884200,'29':8.140607,'36':8.166784,'61':8.202208,'27':8.259717,'58':8.269757,'69':8.285765,'20':8.355380,'30':8.408940,'17':8.562358,'44':8.662678,'12':8.743213,'38':8.970940,'19':9.056490,'43':9.121618,'42':9.301734,'23':9.395574,'25':9.416948,'60':9.439625,'10':9.506511,'13':9.739143,'59':9.951658,'15':10.055264,'31':10.371239,'34':10.373241,'11':10.384462,'39':10.440741,'35':10.489022,'14':11.084647,'21':11.419987,'2':11.596384,'1':11.597331,'41':11.651286,'16':11.673921,'4':11.950535,'5':12.289356,'77':12.657307,'22':12.894413,'56':12.962202,'3':13.111131,'33':13.301675,'24':13.953215,'76':14.175136,'7':14.348277,'6':14.549551,'28':14.648127,'32':15.521852,'8':15.980040}

          var meanCost2014 = {'59':8.959973,'28':11.086259,'24':11.451880,'8':11.513893,'7':11.608740,'32':11.644386,'21':11.736790,'22':12.147390,'58':12.170799,'13':12.439197,'2':12.601089,'16':12.757830,'35':12.763080,'6':12.767118,'5':12.997840,'3':13.082247,'4':13.186839,'40':13.371917,'11':13.551266,'34':13.621462,'77':13.791074,'20':13.819534,'36':14.031437,'31':14.074206,'23':14.125058,'33':14.137951,'1':14.201740,'14':14.412395,'15':14.457016,'37':14.509268,'38':14.616105,'25':14.646950,'61':15.064566,'19':15.121538,'12':15.450099,'27':15.479974,'60':15.485451,'69':15.543148,'44':15.612723,'10':16.005089,'48':16.151812,'9':16.230043,'17':16.423107,'26':16.507565,'18':16.521523,'68':16.713770,'30':17.256399,'47':17.402340,'67':17.578451,'43':17.665924,'39':17.874849,'29':17.888519,'70':17.926399,'66':18.697845,'46':18.910879,'45':18.919008,'63':19.198774,'64':19.407770,'42':19.445017,'57':19.764868,'49':19.781786,'65':20.175129,'50':20.204834,'73':20.370733,'41':20.961714,'71':21.252533,'53':22.519735,'62':24.037056,'74':25.156149,'72':25.502913,'75':25.951698,'54':26.496090,'55':27.427361,'52':28.456600,'51':31.211742,'56':35.298855,'76':39.837700}

          var meanTime2014 = {'59':278.715395,'58':594.559426,'8':661.595653,'32':673.164970,'28':675.462944,'24':690.737847,'7':697.018934,'21':699.709630,'22':735.136932,'6':752.749557,'9':771.947195,'37':775.018868,'3':779.194321,'34':783.319580,'35':785.878226,'16':793.077434,'36':795.383305,'31':822.427337,'27':829.738680,'5':836.222846,'77':839.279350,'23':850.933112,'38':854.041418,'4':875.528212,'44':877.029224,'33':877.404902,'14':886.276875,'60':888.159338,'1':888.380159,'40':890.192090,'10':896.671377,'11':898.358730,'48':917.808219,'2':919.160105,'69':919.284094,'64':920.892043,'25':929.387556,'54':946.466165,'20':951.521279,'61':954.392984,'68':974.259984,'39':976.853854,'17':977.445995,'51':985.137817,'26':1008.956522,'57':1017.832599,'53':1018.522727,'49':1036.453318,'43':1043.977707,'47':1065.263158,'13':1067.285049,'30':1069.008246,'50':1087.350993,'45':1088.016393,'29':1099.078986,'67':1102.520661,'15':1108.198299,'63':1117.657099,'18':1120.180505,'73':1121.215596,'70':1133.142857,'74':1144.054054,'42':1157.205439,'46':1159.907514,'41':1163.668963,'72':1249.645609,'62':1260.560132,'71':1265.010989,'65':1310.699433,'19':1338.348495,'75':1343.396880,'12':1380.210593,'66':1427.254658,'55':1452.916667,'52':1478.128079,'56':1655.281442,'76':1887.348185}

          var tripCountMap2015 = {'54':4.736198,'74':4.890349,'55':5.111988,'52':5.337538,'47':5.556828,'50':5.852202,'72':6.293419,'75':6.340359,'53':6.548219,'9':6.650279,'51':6.747587,'73':6.872128,'18':7.018402,'45':7.037028,'48':7.089243,'65':7.091742,'63':7.106606,'37':7.237059,'26':7.256297,'70':7.287561,'67':7.345365,'46':7.437795,'62':7.476472,'71':7.516433,'57':7.528332,'66':7.535297,'68':7.714677,'40':7.886457,'36':8.102284,'69':8.133000,'61':8.156797,'27':8.174703,'64':8.266421,'20':8.305731,'58':8.306225,'29':8.342125,'30':8.370316,'17':8.601718,'12':8.624252,'44':8.653122,'49':8.814479,'19':8.915969,'38':8.977525,'42':8.979794,'43':8.988321,'60':9.148146,'23':9.305469,'25':9.410092,'13':9.541944,'10':9.611262,'15':9.763478,'59':9.794788,'31':9.997706,'34':10.127311,'39':10.177780,'35':10.373022,'11':10.399494,'14':10.864369,'21':11.123683,'16':11.380491,'2':11.386534,'41':11.428565,'1':11.461695,'4':11.628448,'5':11.884213,'77':12.473290,'22':12.483072,'3':12.878098,'56':13.017636,'33':13.207203,'24':13.594034,'7':14.015084,'76':14.247823,'6':14.251507,'28':14.543726,'32':15.463338,'8':15.868464}

          var meanCostMap2015 = {'59':10.328868,'28':11.246635,'35':11.679705,'24':11.738527,'21':11.781968,'8':11.869397,'7':11.958242,'32':12.032135,'22':12.166145,'49':12.510653,'13':12.548672,'2':12.733043,'23':12.768207,'4':12.939516,'6':12.993425,'5':13.071310,'11':13.184790,'16':13.233733,'58':13.253875,'3':13.334424,'20':13.389496,'36':13.532290,'77':13.625483,'1':13.649171,'38':13.692188,'40':13.794145,'15':13.906552,'34':14.002494,'14':14.640496,'33':14.698532,'27':14.880834,'60':14.964126,'31':15.080213,'19':15.279924,'44':15.559349,'64':15.971650,'37':16.050583,'69':16.117010,'18':16.202078,'25':16.419640,'9':16.510595,'12':16.716829,'63':16.932787,'61':16.998434,'30':17.054571,'17':17.215376,'29':17.294851,'68':17.335300,'10':17.353207,'39':17.385698,'70':17.443722,'51':17.448709,'43':17.514366,'45':17.851126,'48':17.903761,'66':18.008083,'42':18.333263,'26':18.761017,'50':19.143965,'57':19.277258,'55':19.951807,'65':20.430574,'47':20.715830,'41':20.856516,'46':21.822578,'54':22.280703,'73':22.501108,'67':22.745525,'71':22.808443,'62':24.841110,'53':25.442909,'74':26.137669,'52':26.394232,'72':26.710960,'56':35.961266,'76':40.390236,'75':40.590565}

          var meanTimeMap2015 = {'59':248.257525,'58':552.536429,'8':665.024918,'24':672.842868,'28':677.405903,'32':678.520242,'35':679.450993,'21':685.606506,'7':702.160192,'22':721.550526,'51':739.225352,'49':747.713564,'36':754.070260,'6':760.133669,'13':760.357450,'2':762.691116,'54':772.105263,'34':775.949155,'64':788.157286,'11':796.942423,'38':797.493374,'3':804.183996,'16':804.627837,'77':809.719442,'4':820.092119,'23':820.616476,'31':822.482708,'40':839.549042,'1':840.911942,'5':846.099338,'9':847.296248,'27':849.481690,'37':853.035971,'14':853.510329,'60':856.198787,'15':865.115316,'44':870.387570,'10':884.951781,'33':904.080614,'12':907.762803,'69':907.859031,'20':914.736842,'61':923.676513,'25':944.772746,'50':958.793103,'57':991.032258,'63':992.704918,'68':992.985274,'70':993.816689,'39':994.476285,'43':999.548008,'48':1000.333611,'19':1021.151678,'75':1035.238095,'17':1044.216137,'26':1050.486944,'45':1052.636204,'30':1065.837387,'42':1078.843974,'55':1080.722892,'29':1086.132952,'18':1094.180842,'67':1096.384764,'74':1101.654135,'71':1134.744287,'53':1151.174785,'41':1166.577957,'65':1220.515807,'47':1242.857143,'46':1243.719835,'72':1258.447320,'73':1296.373057,'62':1321.664779,'52':1647.980769,'56':1713.602452,'66':1879.861185,'76':1907.521114}

          var maxValue = meanTimeMap2015[Object.keys(meanTimeMap2015).reduce(function(a, b){ return meanTimeMap2015[a] > meanTimeMap2015[b] ? a : b })];
          console.log(maxValue);
          communityCodeMap[1] = 'ROGERS PARK';
          // var hex = "#66ffff";
          // var hex = "#ffff66";
          var hex = "#ffb380";
          var lum = -0.1;
          map.data.setStyle(function(feature) {
            var communityCode = feature.getProperty('communityCode');
            // var color = "gray";

            lum = -0.8 * meanTimeMap2015[communityCode]/maxValue;
            // console.log(lum);
            color = ColorLuminance(hex,lum);
            // if (community == "1") {
            //   color = '#E8E3E3';
            // } else if(community == '76'){
              
            //   color = ColorLuminance(hex,lum); 
            //   // color = "#FF0000";
            // }
            return {
              fillColor: color,
              fillOpacity : 0.8,
              strokeWeight: 0.2,
              saturation : -100,
              lightness: 100
            }
          });
       });
        // var data = JSON.parse(test);
        // // NOTE: This uses cross-domain XHR, and may not work on older browsers.
        // map.data.addGeoJson(data);
      }
      function ColorLuminance(hex, lum) {
        // validate hex string
        hex = String(hex).replace(/[^0-9a-f]/gi, '');
        if (hex.length < 6) {
          hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
        }
        lum = lum || 0;

        // convert to decimal and change luminosity
        var rgb = "#", c, i;
        for (i = 0; i < 3; i++) {
          c = parseInt(hex.substr(i*2,2), 16);
          c = Math.round(Math.min(Math.max(0, c + (c * lum)), 255)).toString(16);
          rgb += ("00"+c).substr(c.length);
        }

        return rgb;
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7AdmmpYy3fHkjOyfUvdBdQdh4vbcP2Xg&callback=initMap">
    </script>
  </body>
</html>